fetch = require('node-fetch')

function removeAllNodes(elements) {
  elements.forEach(e => {
    e.parentNode.removeChild(e);
  })
}

async function easypronunciation_chinese(dom, str) {
  postResp = await fetch("https://easypronunciation.com/en/chinese-pinyin-phonetic-transcription-converter", { "headers": { "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", "accept-language": "en-US,en;q=0.9,ru-UA;q=0.8,ru;q=0.7,ja-JP;q=0.6,ja;q=0.5", "cache-control": "no-cache", "content-type": "application/x-www-form-urlencoded", "pragma": "no-cache", "sec-ch-ua": "\"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\"", "sec-ch-ua-mobile": "?0", "sec-fetch-dest": "document", "sec-fetch-mode": "navigate", "sec-fetch-site": "same-origin", "sec-fetch-user": "?1", "upgrade-insecure-requests": "1", "cookie": "PHPSESSID=ecef07ea5237142e63348f0b5d89c2e8; unique_cookie_id=aa751d5d1aab5285be49126812d67c15; easypronunciation_line_break=p_tag; easypronunciation_spell_the_numbers=no; easypronunciation_show_print_friendly_button=no; easypronunciation_show_copy_to_clipboard_button=no; easypronunciation_show_cheat_sheet_button=0; easypronunciation_click_the_word_phonetic_symbols=0; easypronunciation_click_the_word_audio_video=1; easypronunciation_click_the_word_youtube_search=0; easypronunciation_translation_language=ar; easypronunciation_speech_rate=1; easypronunciation_audio_for_each_paragraph=0; easypronunciation_click_the_word_show_meaning=0; easypronunciation_Display_chinese=above_each_word; easypronunciation_spell_chinese_numbers=none; easypronunciation_spell_latin_letters=yes; easypronunciation_tone_corrections=yes; easypronunciation_frequency_rating_chinese=no; easypronunciation_show_merriam_webster=0; easypronunciation_show_merriam_webster_learners=0; easypronunciation_show_cambridge=0; easypronunciation_show_longman=0; easypronunciation_show_collins=0; easypronunciation_show_lingvo=0; easypronunciation_show_cambridge_french=0; easypronunciation_show_collins_french=0; easypronunciation_show_cambridge_spanish=0; easypronunciation_show_spanishdict=0; easypronunciation_show_wordreference_spanish=0; easypronunciation_show_cambridge_japanese=0; easypronunciation_show_weblio_english_japanese=0; easypronunciation_show_goo=0; easypronunciation_show_dict_cc=0; easypronunciation_show_leo_english_german=0; easypronunciation_show_larousse=0; easypronunciation_show_larousse_french_english=0; easypronunciation_show_collins_french_english=0; easypronunciation_show_cambridge_french_english=0; easypronunciation_show_reverso_french_spanish=0; easypronunciation_show_wordreference_french_spanish=0; easypronunciation_show_glosbe_french_russian=0; easypronunciation_show_dle=0; easypronunciation_show_spanishdict_spanish_english=0; easypronunciation_show_collins_spanish_english=0; easypronunciation_show_cambridge_spanish_english=0; easypronunciation_show_gramota_ru=0; easypronunciation_show_priberam=0; easypronunciation_show_duden=0; easypronunciation_show_cambridge_german_english=0; easypronunciation_show_glosbe_german_russian=0; easypronunciation_show_treccani=0; easypronunciation_show_cambridge_italian_english=0; easypronunciation_show_bkrs=0; easypronunciation_show_leo_chinese_german=0; easypronunciation_show_zdic=0; easypronunciation_show_hjenglish=0; easypronunciation_show_weblio_japanese_chinese=0; easypronunciation_show_weblio_japanese_japanese=0; easypronunciation_show_warodai=0; easypronunciation_Convert_to_chinese=IPA_tone_marks; preferred_language=english; text_length_today=0; text_length_today_time=1614420247" }, "referrer": "https://easypronunciation.com/en/chinese-pinyin-phonetic-transcription-converter", "referrerPolicy": "strict-origin-when-cross-origin", "body": `initial_text=${encodeURIComponent(str)}&submit=&Convert_to_chinese=IPA_tone_marks&translation_language=ar&tts_chinese=amazon_Zhiyu&speech_rate=1&frequency_rating_chinese=no&Display_chinese=above_each_word&line_break=p_tag&tone_corrections=on&spell_chinese_numbers=none&spell_latin_letters=on&click_the_word_audio_video=on&click_the_word_tts=on&MM_update2=form2`, "method": "POST", "mode": "cors" })

  postRespText = postResp.text()

  getResp = await fetch("https://easypronunciation.com/en/chinese-pinyin-phonetic-transcription-converter", { "headers": { "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", "accept-language": "en-US,en;q=0.9,ru-UA;q=0.8,ru;q=0.7,ja-JP;q=0.6,ja;q=0.5", "cache-control": "no-cache", "pragma": "no-cache", "sec-ch-ua": "\"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\"", "sec-ch-ua-mobile": "?0", "sec-fetch-dest": "document", "sec-fetch-mode": "navigate", "sec-fetch-site": "same-origin", "sec-fetch-user": "?1", "upgrade-insecure-requests": "1", "cookie": "PHPSESSID=ecef07ea5237142e63348f0b5d89c2e8; unique_cookie_id=aa751d5d1aab5285be49126812d67c15; easypronunciation_line_break=p_tag; easypronunciation_spell_the_numbers=no; easypronunciation_show_print_friendly_button=no; easypronunciation_show_copy_to_clipboard_button=no; easypronunciation_show_cheat_sheet_button=0; easypronunciation_click_the_word_phonetic_symbols=0; easypronunciation_click_the_word_audio_video=1; easypronunciation_click_the_word_youtube_search=0; easypronunciation_translation_language=ar; easypronunciation_speech_rate=1; easypronunciation_audio_for_each_paragraph=0; easypronunciation_click_the_word_show_meaning=0; easypronunciation_Display_chinese=above_each_word; easypronunciation_spell_chinese_numbers=none; easypronunciation_spell_latin_letters=yes; easypronunciation_tone_corrections=yes; easypronunciation_frequency_rating_chinese=no; easypronunciation_show_merriam_webster=0; easypronunciation_show_merriam_webster_learners=0; easypronunciation_show_cambridge=0; easypronunciation_show_longman=0; easypronunciation_show_collins=0; easypronunciation_show_lingvo=0; easypronunciation_show_cambridge_french=0; easypronunciation_show_collins_french=0; easypronunciation_show_cambridge_spanish=0; easypronunciation_show_spanishdict=0; easypronunciation_show_wordreference_spanish=0; easypronunciation_show_cambridge_japanese=0; easypronunciation_show_weblio_english_japanese=0; easypronunciation_show_goo=0; easypronunciation_show_dict_cc=0; easypronunciation_show_leo_english_german=0; easypronunciation_show_larousse=0; easypronunciation_show_larousse_french_english=0; easypronunciation_show_collins_french_english=0; easypronunciation_show_cambridge_french_english=0; easypronunciation_show_reverso_french_spanish=0; easypronunciation_show_wordreference_french_spanish=0; easypronunciation_show_glosbe_french_russian=0; easypronunciation_show_dle=0; easypronunciation_show_spanishdict_spanish_english=0; easypronunciation_show_collins_spanish_english=0; easypronunciation_show_cambridge_spanish_english=0; easypronunciation_show_gramota_ru=0; easypronunciation_show_priberam=0; easypronunciation_show_duden=0; easypronunciation_show_cambridge_german_english=0; easypronunciation_show_glosbe_german_russian=0; easypronunciation_show_treccani=0; easypronunciation_show_cambridge_italian_english=0; easypronunciation_show_bkrs=0; easypronunciation_show_leo_chinese_german=0; easypronunciation_show_zdic=0; easypronunciation_show_hjenglish=0; easypronunciation_show_weblio_japanese_chinese=0; easypronunciation_show_weblio_japanese_japanese=0; easypronunciation_show_warodai=0; easypronunciation_Convert_to_chinese=IPA_tone_marks; text_length_today_time=1614420247; preferred_language=english; text_length_today=3" }, "referrer": "https://easypronunciation.com/en/chinese-pinyin-phonetic-transcription-converter", "referrerPolicy": "strict-origin-when-cross-origin", "body": null, "method": "GET", "mode": "cors" });

  // '<div class="big-hanzi">\n' +
  // '<p><span class="tooltips-bottom"><ruby><a href="chinese-dictionary-lookup.php?word=%E5%AF%B9%E4%B8%8D%E8%B5%B7&site_language=english&converter_language=chinese&encoding=word_simplified&transcription=pinyin&word_transcription=t%CA%B7%C9%99%CC%80ip%CA%B7ut%C9%95%CA%B0i%CC%8C%CB%90&word_transcription_numbers=dui4%20bu5%20qi3" class="ajax_link hsk-white vocabulary-not-candidate" id="chinese_1">对不起</a><rp>(</rp><rt>tʷə̀ipʷutɕʰǐː<span class="play-video-icon"><i class="fa fa-volume-up"></i></span></rt><rp>)</rp></ruby><span id="tip-for-the-first-word" style="font-size: 60%; margin-top: 10px;"><i class="fa fa-arrow-up"></i> Click the word to see more options!</span></span> </p>\n' +

  getRespText = await getResp.text()

  dom.window.document.body.innerHTML = getRespText

  const text = dom.window.document.querySelector('div.big-hanzi span.tooltips-bottom ruby rt').textContent.trim()

  console.log(text)

  return text
}

exports.easypronunciation_chinese = easypronunciation_chinese
